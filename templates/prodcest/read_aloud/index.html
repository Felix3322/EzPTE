<!-- templates/prodcest/read_aloud/index.html -->
{% extends "layout.html" %}
{% block body %}
<h2>Read Aloud Function</h2>
<button id="loadButton" class="btn btn-primary">Load List</button>
<ul id="listArea" class="mt-3 list-group"></ul>
<div class="my-3">
  <audio id="player" controls></audio>
</div>
<script>
document.getElementById("loadButton").addEventListener("click", function(){
  fetch("/prodcest/read-aloud/list")
    .then(resp => resp.json())
    .then(data => {
      const listArea = document.getElementById("listArea");
      listArea.innerHTML = "";
      data.forEach(item => {
        const li = document.createElement("li");
        li.classList.add("list-group-item");
        li.innerText = "ID: " + item.编号;
        li.onclick = () => {
          document.getElementById("player").src = item.audio_api;
          // 如有需要，可 fetch 文本内容
          fetch(item.text_api)
            .then(r => r.json())
            .then(txt => {
              alert("Text: " + txt.text);
            });
        };
        listArea.appendChild(li);
      });
    })
    .catch(err => console.error(err));
});
</script>
{% endblock %}
